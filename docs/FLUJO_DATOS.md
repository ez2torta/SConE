# ğŸ”„ Flujo de Datos - Arquitectura del Sistema

Este documento muestra el flujo completo de datos desde la entrada Serial hasta el SNES.

## ğŸ“Š Diagrama de Arquitectura Completo

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FUENTE DE ENTRADA                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                        â”‚                        â”‚
         â–¼                        â–¼                        â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Python  â”‚            â”‚ Arduino  â”‚            â”‚ Botones  â”‚
   â”‚  Script  â”‚            â”‚   Otro   â”‚            â”‚ FÃ­sicos  â”‚
   â”‚          â”‚            â”‚  ESP32   â”‚            â”‚  GPIO    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                        â”‚                        â”‚
         â”‚ Serial USB             â”‚ Serial TXâ†’RX           â”‚ digitalRead()
         â”‚ 115200 baud            â”‚                        â”‚
         â”‚ 4 bytes                â”‚ 4 bytes                â”‚ 12 pines
         â”‚ little-endian          â”‚ little-endian          â”‚ INPUT_PULLUP
         â”‚                        â”‚                        â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            ESP32                                      â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ void loop()                                                   â”‚   â”‚
â”‚  â”‚                                                               â”‚   â”‚
â”‚  â”‚  if (Serial.available() >= 4) {                              â”‚   â”‚
â”‚  â”‚      uint8_t bytes[4];                                       â”‚   â”‚
â”‚  â”‚      Serial.readBytes(bytes, 4);                             â”‚   â”‚
â”‚  â”‚      buttonState = bytes[0] | bytes[1]<<8 |                  â”‚   â”‚
â”‚  â”‚                    bytes[2]<<16 | bytes[3]<<24;              â”‚   â”‚
â”‚  â”‚  }                                                            â”‚   â”‚
â”‚  â”‚                                                               â”‚   â”‚
â”‚  â”‚  // buttonState ahora contiene el uint32_t completo          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                  â”‚                                    â”‚
â”‚                                  â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ if (useSerial)                                               â”‚   â”‚
â”‚  â”‚     buttons = mapSerialToSNES(buttonState);                  â”‚   â”‚
â”‚  â”‚ else                                                          â”‚   â”‚
â”‚  â”‚     buttons = readPhysicalButtons();                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                  â”‚                                    â”‚
â”‚                                  â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ uint32_t mapSerialToSNES(uint32_t serialData)                â”‚   â”‚
â”‚  â”‚                                                               â”‚   â”‚
â”‚  â”‚  Mapeo de bits:                                              â”‚   â”‚
â”‚  â”‚  bit 0  â†’ SNES_B  (clock 1)                                  â”‚   â”‚
â”‚  â”‚  bit 1  â†’ SNES_Y  (clock 2)                                  â”‚   â”‚
â”‚  â”‚  bit 8  â†’ SNES_UP (clock 5)                                  â”‚   â”‚
â”‚  â”‚  bit 12 â†’ SNES_A  (clock 9)                                  â”‚   â”‚
â”‚  â”‚  ... (total 12 botones)                                      â”‚   â”‚
â”‚  â”‚                                                               â”‚   â”‚
â”‚  â”‚  return snesButtons;                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                  â”‚                                    â”‚
â”‚                                  â–¼                                    â”‚
â”‚                           uint32_t buttons                            â”‚
â”‚                     (12 bits activos, orden SNES)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      PROTOCOLO SNES                                   â”‚
â”‚                                                                       â”‚
â”‚  while(digitalRead(LATCH_PIN) != HIGH);  // Esperar latch             â”‚
â”‚  while(digitalRead(LATCH_PIN) == HIGH);  // Esperar que baje          â”‚
â”‚                                                                       â”‚
â”‚  for (cada uno de los 12 botones) {                                  â”‚
â”‚      sendButtonBit(buttons, bitPosition);                            â”‚
â”‚      waitForClockCycle();                                            â”‚
â”‚  }                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
                          GPIO 27 (DATA)
                    (12 pulsos, LOW/HIGH)
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CONSOLA SNES                                  â”‚
â”‚                                                                       â”‚
â”‚  Lee DATA en cada flanco de CLOCK:                                   â”‚
â”‚                                                                       â”‚
â”‚  Clock 1:  B      (LOW = presionado, HIGH = no)                      â”‚
â”‚  Clock 2:  Y                                                          â”‚
â”‚  Clock 3:  SELECT                                                     â”‚
â”‚  Clock 4:  START                                                      â”‚
â”‚  Clock 5:  UP                                                         â”‚
â”‚  Clock 6:  DOWN                                                       â”‚
â”‚  Clock 7:  LEFT                                                       â”‚
â”‚  Clock 8:  RIGHT                                                      â”‚
â”‚  Clock 9:  A                                                          â”‚
â”‚  Clock 10: X                                                          â”‚
â”‚  Clock 11: L                                                          â”‚
â”‚  Clock 12: R                                                          â”‚
â”‚  Clock 13-16: (no usado)                                              â”‚
â”‚                                                                       â”‚
â”‚  â†’ Interpreta los botones y los pasa al juego                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
                        ğŸ® JUEGO EN SNES
```

## ğŸ”€ Flujo de un BotÃ³n Individual

Ejemplo: Presionar el botÃ³n **A**

```
1. ENTRADA PYTHON
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ comando = 1 << 12  # 0x00001000      â”‚
   â”‚ bytes = [0x00, 0x10, 0x00, 0x00]     â”‚
   â”‚ ser.write(bytes)                     â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚ Serial USB
                  â–¼
2. RECEPCIÃ“N ESP32
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ bytes[0] = 0x00                      â”‚
   â”‚ bytes[1] = 0x10                      â”‚
   â”‚ bytes[2] = 0x00                      â”‚
   â”‚ bytes[3] = 0x00                      â”‚
   â”‚                                      â”‚
   â”‚ buttonState = 0x00001000             â”‚
   â”‚ (bit 12 = 1, resto = 0)              â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
3. MAPEO
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ mapSerialToSNES(0x00001000)          â”‚
   â”‚                                      â”‚
   â”‚ if (0x00001000 & (1 << 12))          â”‚
   â”‚     snesButtons |= (1 << SNES_A);    â”‚
   â”‚                                      â”‚
   â”‚ return 0x00000100  (bit 8 = SNES_A)  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
4. ESPERA LATCH
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ SNES activa LATCH (HIGH)             â”‚
   â”‚ ESP32 detecta y espera que baje      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
5. ENVÃO SERIAL SNES
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Clock 1 (B):      HIGH (no presionado)â”‚
   â”‚ Clock 2 (Y):      HIGH (no presionado)â”‚
   â”‚ Clock 3 (SELECT): HIGH (no presionado)â”‚
   â”‚ Clock 4 (START):  HIGH (no presionado)â”‚
   â”‚ Clock 5 (UP):     HIGH (no presionado)â”‚
   â”‚ Clock 6 (DOWN):   HIGH (no presionado)â”‚
   â”‚ Clock 7 (LEFT):   HIGH (no presionado)â”‚
   â”‚ Clock 8 (RIGHT):  HIGH (no presionado)â”‚
   â”‚ Clock 9 (A):      LOW  (âœ… PRESIONADO)â”‚
   â”‚ Clock 10 (X):     HIGH (no presionado)â”‚
   â”‚ Clock 11 (L):     HIGH (no presionado)â”‚
   â”‚ Clock 12 (R):     HIGH (no presionado)â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
6. SNES LEE
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ BotÃ³n A detectado como presionado    â”‚
   â”‚ â†’ AcciÃ³n en el juego (saltar, etc.)  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## â±ï¸ Timeline Temporal

```
Tiempo (Î¼s)    LATCH    CLOCK    DATA      AcciÃ³n
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    0            â”€        â”€        â”€       [Esperando...]
   
  ~16667         â”Œâ”€       â”€        â”€       Inicio ciclo
  ~16679         â””â”€       â”€        â”€       Latch baja
  
  ~16685         â”€       â”Œâ”€        B       Clock 1 sube
  ~16691         â”€       â””â”€        B       Clock 1 baja
  
  ~16697         â”€       â”Œâ”€        Y       Clock 2 sube
  ~16703         â”€       â””â”€        Y       Clock 2 baja
  
  ... (clocks 3-8 similares)
  
  ~16745         â”€       â”Œâ”€        A       Clock 9 sube â† A aquÃ­
  ~16751         â”€       â””â”€        A       Clock 9 baja
  
  ... (clocks 10-12)
  
  ~16800         â”€        â”€        â”€       Ciclo completo
  ~33467         â”Œâ”€       â”€        â”€       Siguiente ciclo
```

**Frecuencia:** ~60 Hz (cada 16.67 ms)  
**Tiempo por botÃ³n:** ~6 Î¼s

## ğŸ§® TransformaciÃ³n de Datos

### Paso a Paso con Ejemplo Real

**Entrada:** Presionar **UP + A** (salto)

```
PYTHON:
  up_bit = 1 << 8   = 0x00000100
  a_bit  = 1 << 12  = 0x00001000
  comando = up_bit | a_bit = 0x00001100
  
  bytes = [0x00, 0x11, 0x00, 0x00]  (little-endian)
         â””â”€â”¬â”€â”˜ â””â”€â”¬â”€â”˜ â””â”€â”¬â”€â”˜ â””â”€â”¬â”€â”˜
         byte0 byte1 byte2 byte3

SERIAL (4 bytes):
  0x00 0x11 0x00 0x00

ESP32 RECIBE:
  bytes[0] = 0x00
  bytes[1] = 0x11
  bytes[2] = 0x00
  bytes[3] = 0x00
  
  buttonState = 0x00 | (0x11 << 8) | (0x00 << 16) | (0x00 << 24)
              = 0x00001100
  
  En binario: 0000 0000 0000 0001 0001 0000 0000 0000
                              â”‚    â”‚
                            bit12 bit8
                              A    UP

MAPEO:
  if (buttonState & (1 << 8))  â†’ SNES_UP  (bit 4)
  if (buttonState & (1 << 12)) â†’ SNES_A   (bit 8)
  
  snesButtons = (1 << 4) | (1 << 8) = 0x00000110
  
  En binario: 0000 0000 0000 0000 0000 0001 0001 0000
                                            â”‚    â”‚
                                          bit8  bit4
                                           A    UP

ENVÃO SNES:
  Clock 1 (B):      bit 0 = 0 â†’ HIGH
  Clock 2 (Y):      bit 1 = 0 â†’ HIGH
  Clock 3 (SELECT): bit 2 = 0 â†’ HIGH
  Clock 4 (START):  bit 3 = 0 â†’ HIGH
  Clock 5 (UP):     bit 4 = 1 â†’ LOW  âœ…
  Clock 6 (DOWN):   bit 5 = 0 â†’ HIGH
  Clock 7 (LEFT):   bit 6 = 0 â†’ HIGH
  Clock 8 (RIGHT):  bit 7 = 0 â†’ HIGH
  Clock 9 (A):      bit 8 = 1 â†’ LOW  âœ…
  Clock 10 (X):     bit 9 = 0 â†’ HIGH
  Clock 11 (L):     bit 10 = 0 â†’ HIGH
  Clock 12 (R):     bit 11 = 0 â†’ HIGH
```

## ğŸ” VerificaciÃ³n de Bits

Herramienta de debugging para verificar quÃ© bits estÃ¡n activos:

```cpp
void printBits(uint32_t value, const char* label) {
    Serial.print(label);
    Serial.print(": 0x");
    Serial.print(value, HEX);
    Serial.print(" = ");
    
    for (int i = 15; i >= 0; i--) {
        Serial.print((value >> i) & 1);
        if (i % 4 == 0) Serial.print(" ");
    }
    Serial.println();
}

// Uso:
printBits(buttonState, "Serial");    // Lo que llega por Serial
printBits(snesButtons, "SNES");      // Lo que se envÃ­a al SNES
```

**Salida esperada para UP + A:**
```
Serial: 0x00001100 = 0001 0001 0000 0000
SNES:   0x00000110 = 0000 0001 0001 0000
```

## ğŸ“¡ Monitoreo en Tiempo Real

AÃ±ade esto al cÃ³digo para ver el flujo de datos:

```cpp
void setup() {
    Serial.begin(115200);
    Serial.println("=== Monitor de Flujo de Datos ===");
}

void loop() {
    // ... cÃ³digo normal ...
    
    if (buttonState != 0) {  // Solo mostrar si hay botones presionados
        Serial.print("RX: 0x");
        Serial.print(buttonState, HEX);
        Serial.print(" â†’ SNES: 0x");
        Serial.println(snesButtons, HEX);
    }
}
```

## ğŸ¯ Resumen del Flujo

1. **Python/Arduino** â†’ envÃ­a 4 bytes por Serial
2. **ESP32** â†’ convierte bytes a `uint32_t`
3. **mapSerialToSNES()** â†’ reorganiza bits al orden SNES
4. **Espera LATCH** â†’ sincroniza con el SNES
5. **12 clocks** â†’ envÃ­a cada botÃ³n en orden
6. **SNES** â†’ lee y pasa al juego

**Latencia total:** ~1-2 ms (principalmente espera del SNES)

---

**Â¿Necesitas mÃ¡s detalles?** Consulta el cÃ³digo fuente comentado en `snes_esp32.ino` ğŸ”
